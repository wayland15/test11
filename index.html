<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Квест-экскурсия — БГУИР</title>
  <style>
    :root { --bg: #0b0f14; --card: #161e29; --accent: #6ee7b7; --muted: #9aa4b2; --border: rgba(255, 255, 255, 0.08); }
    html, body { height: 100%; margin: 0; font-family: 'Inter', sans-serif; background: linear-gradient(180deg, #061018 0%, #0b1220 100%); color: #e6eef6; }
    .app { display: flex; height: 100vh; gap: 20px; padding: 20px; box-sizing: border-box; }
    
    /* САЙДБАР */
    .sidebar { width: 340px; background: rgba(255, 255, 255, 0.03); border-radius: 16px; padding: 20px; display: flex; flex-direction: column; border: 1px solid var(--border); overflow-y: auto; }
    h1 { font-size: 20px; margin: 0 0 8px; color: #fff; }
    .hint { font-size: 13px; color: var(--muted); margin-bottom: 20px; }

    /* БЛОК КОРПУСА */
    .building-card { margin-bottom: 15px; background: var(--card); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; transition: 0.2s; }
    
    /* Заголовок корпуса (Кликабельный) */
    .building-header { padding: 15px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.02); font-weight: 600; color: var(--accent); }
    .building-header:hover { background: rgba(255,255,255,0.05); }
    .building-card.active { border-color: var(--accent); box-shadow: 0 0 15px rgba(110, 231, 183, 0.1); }
    .building-card.active .building-header { background: var(--accent); color: #000; }

    /* Список задач (Некликабельный) */
    .quest-list { display: flex; flex-direction: column; padding: 5px 0; background: #111; }
    .quest-item { padding: 8px 15px; font-size: 13px; color: var(--muted); display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .quest-item:last-child { border-bottom: none; }
    
    /* Галочка */
    .checkbox { width: 18px; height: 18px; border: 2px solid #444; border-radius: 4px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
    .quest-item.done { color: #fff; text-decoration: line-through; opacity: 0.6; }
    .quest-item.done .checkbox { background: var(--accent); border-color: var(--accent); color: #000; font-weight: bold; }
    .quest-item.done .checkbox::after { content: '✓'; font-size: 12px; }

    /* ОСНОВНАЯ ЧАСТЬ */
    .main { flex: 1; display: flex; flex-direction: column; gap: 15px; }
    .controls { display: flex; gap: 12px; align-items: center; background: var(--card); padding: 12px; border-radius: 12px; border: 1px solid var(--border); }
    .btn { background: var(--accent); border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; color: #0b1220; }
    .btn:hover { opacity: 0.9; }
    .btn:disabled { background: #333; color: #555; cursor: not-allowed; }
    .btn.secondary { background: transparent; border: 1px solid #555; color: #ccc; font-weight: 500; }

    .viewer { flex: 1; background: #000; border-radius: 14px; border: 1px solid var(--border); position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
    .viewer img { width: 100%; height: 100%; object-fit: cover; }
  </style>
</head>
<body>

<div class="app">
  <aside class="sidebar">
    <h1>БГУИР — VR Квест</h1>
    <div class="hint">Выбери корпус и нажми "Начать". Ищи локации!</div>
    <div id="buildingsList"></div>
  </aside>

  <main class="main">
    <div class="controls">
      <div style="flex:1">
        <div style="font-size:12px; color:var(--muted)">Выбранный корпус:</div>
        <div id="currentTitle" style="font-weight:bold; font-size:16px;">—</div>
      </div>
      <button id="openTourBtn" class="btn" disabled>Начать экскурсию</button>
      <button id="resetBtn" class="btn secondary">Сброс</button>
    </div>
    
    <div class="viewer" id="viewer">
      <div style="color:#555">Выберите корпус слева</div>
    </div>
  </main>
</div>

<script>
  // === НАСТРОЙКИ ===
  // 1. id корпуса: нужен для картинки (place/building_2.jpg)
  // 2. startUrl: ссылка на самую первую точку тура
  // 3. quests -> id: ВАЖНО! Этот id должен совпадать с тем, который вы пропишете в туре
  const buildings = [
    {
      id: 'building_2',
      title: 'Учебный корпус №2',
      startUrl: 'hall/index.html', 
      quests: [
        { id: 'hall', title: 'Главный холл' },
        { id: 'library', title: 'Аудитория №502' },
        { id: 'canteen', title: 'Столовая' }
      ]
    },
    {
      id: 'building_3',
      title: 'Учебный корпус №3',
      startUrl: 'k3/hall/index.html',
      quests: [
        { id: 'k3_hall', title: 'Главный холл' },
        { id: 'k3_audit', title: 'Военный факультет' }
      ]
    },
    {
      id: 'building_6',
      title: 'Спорткомплекс',
      startUrl: 'k3/hall/index.html',
      quests: [
        { id: 'k3_hall', title: 'Спорткомплекс' }
      ]
    },
    {
      id: 'building_5',
      title: 'Учебный корпус №5',
      startUrl: 'k3/hall/index.html',
      quests: [
        { id: 'k3_hall', title: 'Спорткомплекс' }
      ]
    },
    {
      id: 'building_6',
      title: 'Спорткомплекс',
      startUrl: 'k3/hall/index.html',
      quests: [
        { id: 'k3_hall', title: 'Аудитория №ХХХ' },
         { id: 'k3_hall', title: 'Аудитория №ХХХ' },
         { id: 'k3_hall', title: 'Аудитория №ХХХ' }
      ]
    },
     {
      id: 'building_78',
      title: 'Учебный корпус №3',
      startUrl: 'k3/hall/index.html',
      quests: [
        { id: 'k3_audit', title: 'Музей' }
      ]
    },
     {
      id: 'domitory_1',
      title: 'Учебный корпус №3',
      startUrl: 'k3/hall/index.html',
      quests: [
        { id: 'k3_audit', title: 'Вахта' },
        { id: 'k3_audit', title: 'Жилая комната' }
      ]
    },
     {
      id: 'relax',
      title: 'Учебный корпус №3',
      startUrl: 'k3/hall/index.html',
      quests: [
        { id: 'k3_audit', title: 'СОК «Браславские озера»' }
      ]
    }
  ];

  const listContainer = document.getElementById('buildingsList');
  const viewer = document.getElementById('viewer');
  const titleEl = document.getElementById('currentTitle');
  const openBtn = document.getElementById('openTourBtn');
  
  let currentBuilding = null;
  // Храним посещенные id: { 'hall': true, 'library': true }
  let visited = JSON.parse(localStorage.getItem('bsuir_quest_progress') || '{}');

  // --- ОТРИСОВКА ИНТЕРФЕЙСА ---
  function render() {
    listContainer.innerHTML = '';
    
    buildings.forEach(b => {
      const card = document.createElement('div');
      card.className = `building-card ${currentBuilding === b ? 'active' : ''}`;
      
      // Заголовок (кликабельный)
      const header = document.createElement('div');
      header.className = 'building-header';
      header.innerHTML = `<span>${b.title}</span>`;
      header.onclick = () => selectBuilding(b);
      
      // Список задач (некликабельный, статус)
      const list = document.createElement('div');
      list.className = 'quest-list';
      
      b.quests.forEach(q => {
        const isDone = visited[q.id];
        const item = document.createElement('div');
        item.className = `quest-item ${isDone ? 'done' : ''}`;
        item.innerHTML = `
          <div class="checkbox"></div>
          <span>${q.title}</span>
        `;
        list.appendChild(item);
      });

      card.appendChild(header);
      card.appendChild(list);
      listContainer.appendChild(card);
    });
  }

  function selectBuilding(b) {
    currentBuilding = b;
    titleEl.textContent = b.title;
    openBtn.disabled = false;
    
    // Картинка корпуса из папки place (например: place/building_2.jpg)
    viewer.innerHTML = `<img src="place/${b.id}.jpg" onerror="this.src='https://via.placeholder.com/800?text=Фото+корпуса'">`;
    
    render(); // Обновляем подсветку
  }

  // --- ОТКРЫТИЕ ТУРА ---
  openBtn.onclick = () => {
    if(currentBuilding) {
      window.open(currentBuilding.startUrl, '_blank');
    }
  };

  // --- АВТОМАТИЧЕСКАЯ СИНХРОНИЗАЦИЯ ---
  // Слушаем события от других вкладок (от туров)
  window.addEventListener('storage', (e) => {
    if (e.key === 'bsuir_quest_update') {
      // Читаем обновленные данные
      visited = JSON.parse(localStorage.getItem('bsuir_quest_progress') || '{}');
      render(); // Перерисовываем галочки
    }
  });

  // Начальная отрисовка
  render();

  // Сброс
  document.getElementById('resetBtn').onclick = () => {
    if(confirm('Сбросить весь прогресс?')) {
      localStorage.removeItem('bsuir_quest_progress');
      visited = {};
      render();
    }
  };
</script>
</body>
</html>


